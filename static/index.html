<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESP Desk_OS | Control Dashboard</title>
    <meta name="description" content="ESP32 OLED Display Control Dashboard" />
    <meta name="author" content="boredom1234" />
    <meta
      name="keywords"
      content="ESP32, OLED Display, Control Dashboard, ESP Desk OS, ESP Desk OS Control Dashboard, ESP Desk OS Control Panel"
    />
    <link rel="stylesheet" href="css/style.css" />
    <!-- favicon -->
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <!-- Login Modal -->
    <div class="login-overlay" id="loginOverlay">
      <div class="login-card">
        <div class="login-header">
          <span class="login-icon">‚óá</span>
          <h2>ESP DESK_OS</h2>
        </div>
        <p class="login-subtitle">Enter password to access dashboard</p>
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="login-input-group">
            <input
              type="password"
              id="loginPassword"
              placeholder="Password"
              autocomplete="current-password"
              required
            />
          </div>
          <div class="login-error" id="loginError"></div>
          <button type="submit" class="btn btn-primary login-btn" id="loginBtn">
            Access Dashboard
          </button>
        </form>
      </div>
    </div>

    <div class="container" id="mainContainer">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <span class="icon">‚óá</span>
          <h1>ESP DESK_OS</h1>
        </div>
        <div class="header-right">
          <div class="status-pill">
            <span class="dot"></span>
            <span id="systemStatus">ONLINE</span>
          </div>
          <button
            class="btn-icon"
            id="logoutBtn"
            onclick="handleLogout()"
            title="Logout"
            style="display: none"
          >
            ‚èª
          </button>
        </div>
      </header>

      <!-- Main Grid -->
      <main class="grid-layout">
        <!-- Left Column: Visual Feed -->
        <div class="left-column">
          <section class="card preview-section">
            <div class="card-header">
              <h2>Visual Feed</h2>
              <div class="badge-group">
                <span class="badge" id="frameBadge">1/1</span>
                <span class="badge" id="mode-badge">AUTO</span>
              </div>
            </div>

            <div class="canvas-wrapper">
              <canvas id="preview" width="512" height="256"></canvas>
            </div>

            <div class="player-controls">
              <div class="playback-buttons">
                <button
                  class="btn btn-icon-only"
                  onclick="prevFrame()"
                  title="Previous Frame"
                >
                  ‚óÄ
                </button>
                <button
                  class="btn btn-primary btn-play"
                  id="autoPlayBtn"
                  onclick="toggleAutoPlay()"
                >
                  ‚ñ∂ Auto-Play
                </button>
                <button
                  class="btn btn-icon-only"
                  onclick="nextFrame()"
                  title="Next Frame"
                >
                  ‚ñ∂
                </button>
              </div>

              <div class="slider-group compact">
                <label>Speed: <span id="speedValue">200ms</span></label>
                <input
                  type="range"
                  id="speedSlider"
                  min="50"
                  max="1000"
                  value="200"
                  oninput="updateSpeed(this.value)"
                />
              </div>
            </div>
          </section>

          <!-- Display Cycle (Now in left column or bottom, let's put it below preview) -->
          <section class="card cycle-section">
            <div class="card-header">
              <h2>Display Cycle</h2>
              <small>Drag to reorder</small>
            </div>
            <div class="display-cycle-list" id="displayCycleList">
              <!-- Items will be dynamically generated -->
            </div>

            <div class="cycle-add-area">
              <div class="add-row">
                <select id="addItemType" class="modern-select">
                  <option value="time">üïê Time</option>
                  <option value="bcd">üî¢ BCD Clock</option>
                  <option value="analog">üßÆ Analog Clock</option>
                  <option value="spotify">üéµ Now Playing</option>
                  <option value="weather">üå§ Weather</option>
                  <option value="uptime">‚è± Uptime</option>
                  <option value="text">üí¨ Text</option>
                  <option value="image">üñº Image</option>
                  <option value="pomodoro">üçÖ Pomodoro</option>
                  <option value="countdown">‚è≥ Countdown</option>
                  <option value="qr">üì± QR Code</option>
                </select>
                <button
                  class="btn btn-secondary btn-sm"
                  onclick="addCycleItem()"
                >
                  + Add Widget
                </button>
              </div>

              <!-- Text Config Panel (Hidden by default) -->
              <div
                class="text-item-config"
                id="textItemConfig"
                style="display: none"
              >
                <div class="input-with-action">
                  <input
                    type="text"
                    id="newItemText"
                    placeholder="Enter message..."
                    maxlength="30"
                  />
                  <button
                    class="btn btn-primary btn-sm"
                    onclick="confirmAddText()"
                  >
                    Save
                  </button>
                </div>
                <div class="style-pills">
                  <button
                    class="style-pill active"
                    data-style="normal"
                    onclick="setNewItemStyle('normal')"
                  >
                    Normal
                  </button>
                  <button
                    class="style-pill"
                    data-style="centered"
                    onclick="setNewItemStyle('centered')"
                  >
                    Centered
                  </button>
                  <button
                    class="style-pill"
                    data-style="framed"
                    onclick="setNewItemStyle('framed')"
                  >
                    Framed
                  </button>
                </div>
              </div>

              <!-- Countdown Config Panel -->
              <div
                class="countdown-item-config"
                id="countdownItemConfig"
                style="display: none"
              >
                <div class="input-with-action">
                  <input
                    type="text"
                    id="countdownLabel"
                    placeholder="Event name (e.g., New Year)..."
                    maxlength="20"
                  />
                  <input type="date" id="countdownDate" />
                  <button
                    class="btn btn-primary btn-sm"
                    onclick="confirmAddCountdown()"
                  >
                    Save
                  </button>
                </div>
              </div>

              <!-- QR Code Config Panel -->
              <div
                class="qr-item-config"
                id="qrItemConfig"
                style="display: none"
              >
                <div class="input-group">
                  <textarea
                    id="qrDataInput"
                    placeholder="Enter URL, text, WiFi config..."
                    rows="2"
                    maxlength="300"
                  ></textarea>
                </div>
                <div class="action-row">
                  <button
                    class="btn btn-secondary btn-sm"
                    onclick="displayQRNow()"
                  >
                    Display Now
                  </button>
                  <button
                    class="btn btn-primary btn-sm"
                    onclick="confirmAddQR()"
                  >
                    Save to Cycle
                  </button>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Right Column: Controls -->
        <div class="right-column">
          <!-- Interactive Control Panel (Tabs) -->
          <section class="card control-panel">
            <div class="tabs">
              <button class="tab-btn active" onclick="switchTab('quickText')">
                Text
              </button>
              <button class="tab-btn" onclick="switchTab('marquee')">
                Marquee
              </button>
              <button class="tab-btn" onclick="switchTab('upload')">
                Media
              </button>
              <button class="tab-btn" onclick="switchTab('pomodoro')">
                Timer
              </button>
            </div>

            <div class="tab-content" id="tab-quickText">
              <div class="input-group">
                <textarea
                  id="customText"
                  placeholder="Enter display text..."
                  rows="3"
                  maxlength="100"
                ></textarea>
                <div class="limit-indicator">
                  <span id="customTextCounter">0/10</span> chars/line
                </div>
              </div>

              <div class="style-toggles">
                <label class="style-toggle">
                  <input type="checkbox" id="styleCentered" />
                  <span>‚ä° Centered</span>
                </label>
                <label class="style-toggle">
                  <input type="checkbox" id="styleFramed" />
                  <span>‚ñ¢ Framed</span>
                </label>
                <label class="style-toggle">
                  <input type="checkbox" id="styleLarge" />
                  <span>A Large</span>
                </label>
                <label class="style-toggle">
                  <input type="checkbox" id="styleInverted" />
                  <span>‚óê Invert</span>
                </label>
              </div>

              <div class="action-footer">
                <button class="btn btn-primary" onclick="sendCustomText()">
                  Display Now
                </button>
              </div>
            </div>

            <div class="tab-content" id="tab-marquee" style="display: none">
              <div class="input-group">
                <textarea
                  id="marqueeText"
                  placeholder="Scrolling message..."
                  rows="3"
                  maxlength="100"
                ></textarea>
                <div class="limit-indicator">
                  <span id="marqueeTextCounter">0/100</span> chars
                </div>
              </div>

              <div class="settings-row">
                <div class="setting-col">
                  <label>Direction</label>
                  <div class="toggle-group">
                    <button
                      class="toggle-opt active"
                      id="dirLeft"
                      onclick="setDirection('left')"
                    >
                      ‚Üê
                    </button>
                    <button
                      class="toggle-opt"
                      id="dirRight"
                      onclick="setDirection('right')"
                    >
                      ‚Üí
                    </button>
                  </div>
                </div>
                <div class="setting-col">
                  <label>Size</label>
                  <div class="toggle-group">
                    <button
                      class="toggle-opt"
                      data-size="1"
                      onclick="setMarqueeSize(1)"
                    >
                      1x
                    </button>
                    <button
                      class="toggle-opt active"
                      data-size="2"
                      onclick="setMarqueeSize(2)"
                    >
                      2x
                    </button>
                    <button
                      class="toggle-opt"
                      data-size="3"
                      onclick="setMarqueeSize(3)"
                    >
                      3x
                    </button>
                  </div>
                </div>
              </div>

              <div class="sliders-stack">
                <div class="slider-row">
                  <label>Speed <span id="marqueeSpeedVal">3</span></label>
                  <input
                    type="range"
                    id="marqueeSpeed"
                    min="1"
                    max="8"
                    value="3"
                    oninput="document.getElementById('marqueeSpeedVal').textContent=this.value"
                  />
                </div>
                <div class="slider-row">
                  <label>Frames <span id="marqueeMaxFramesVal">5</span></label>
                  <input
                    type="range"
                    id="marqueeMaxFrames"
                    min="2"
                    max="20"
                    value="5"
                    oninput="document.getElementById('marqueeMaxFramesVal').textContent=this.value"
                  />
                </div>
              </div>

              <div class="style-toggles">
                <label class="style-toggle">
                  <input type="checkbox" id="marqueeFramed" />
                  <span>‚ñ¢ Static Frame</span>
                </label>
              </div>

              <div class="action-footer">
                <button class="btn btn-primary" onclick="sendMarquee()">
                  Start Scroll
                </button>
              </div>
            </div>

            <div class="tab-content" id="tab-upload" style="display: none">
              <div class="drop-zone" id="dropZone" tabindex="0">
                <div class="drop-content">
                  <span class="icon">‚òÅÔ∏è</span>
                  <p>Drop file or click</p>
                  <small>PNG, JPG, GIF</small>
                </div>
                <input type="file" id="imageUpload" accept="image/*" hidden />
              </div>

              <div
                class="upload-preview"
                id="uploadPreview"
                style="display: none"
              >
                <img id="previewThumbnail" alt="Preview" />
                <div class="info">
                  <span id="previewFileName">file.png</span>
                  <button class="close-btn" onclick="clearUploadPreview()">
                    ‚úï
                  </button>
                </div>
              </div>

              <div class="upload-controls">
                <div class="slider-row">
                  <label
                    >GIF Speed <span id="gifFpsValue">Original</span></label
                  >
                  <input
                    type="range"
                    id="gifFpsSlider"
                    min="0"
                    max="30"
                    value="0"
                    oninput="updateGifFps(this.value)"
                  />
                </div>
                <div class="slider-row">
                  <label
                    >Max Frames <span id="gifMaxFramesValue">10</span></label
                  >
                  <input
                    type="range"
                    id="gifMaxFramesSlider"
                    min="2"
                    max="20"
                    value="10"
                    oninput="document.getElementById('gifMaxFramesValue').textContent=this.value"
                  />
                </div>
              </div>

              <div class="action-footer">
                <span class="badge" id="uploadStatus">Ready</span>
                <div class="btn-group">
                  <button
                    class="btn btn-secondary"
                    id="saveToCycleBtn"
                    onclick="saveImageToCycle()"
                    style="display: none"
                  >
                    Save
                  </button>
                  <button
                    class="btn btn-primary"
                    onclick="processAndUploadImage()"
                  >
                    Upload
                  </button>
                </div>
              </div>
            </div>

            <div class="tab-content" id="tab-pomodoro" style="display: none">
              <div class="pomodoro-display">
                <div class="pomodoro-mode" id="pomodoroMode">READY</div>
                <div class="pomodoro-time" id="pomodoroTime">25:00</div>
                <div class="pomodoro-cycles" id="pomodoroCycles">Cycle 0/4</div>
              </div>

              <div class="pomodoro-controls">
                <button
                  class="btn btn-primary"
                  id="pomodoroStartBtn"
                  onclick="startPomodoro()"
                >
                  ‚ñ∂ Start
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="resetPomodoro()"
                  title="Reset"
                >
                  ‚Ü∫
                </button>
                <button
                  class="btn btn-secondary"
                  onclick="skipPhase()"
                  title="Skip to next phase"
                >
                  ‚è≠
                </button>
              </div>

              <div class="pomodoro-settings">
                <div class="slider-row">
                  <label>Work <span id="workDurationVal">25</span> min</label>
                  <input
                    type="range"
                    id="workDuration"
                    min="1"
                    max="60"
                    value="25"
                    oninput="updateDurationDisplay('work', this.value)"
                  />
                </div>
                <div class="slider-row">
                  <label>Break <span id="breakDurationVal">5</span> min</label>
                  <input
                    type="range"
                    id="breakDuration"
                    min="1"
                    max="30"
                    value="5"
                    oninput="updateDurationDisplay('break', this.value)"
                  />
                </div>
                <div class="slider-row">
                  <label
                    >Long Break <span id="longBreakVal">15</span> min</label
                  >
                  <input
                    type="range"
                    id="longBreakDuration"
                    min="5"
                    max="45"
                    value="15"
                    oninput="updateDurationDisplay('longBreak', this.value)"
                  />
                </div>
                <div class="slider-row">
                  <label>Cycles <span id="cyclesVal">4</span></label>
                  <input
                    type="range"
                    id="cycleCount"
                    min="2"
                    max="8"
                    value="4"
                    oninput="updateDurationDisplay('cycles', this.value)"
                  />
                </div>
                <button
                  class="btn btn-secondary btn-sm"
                  onclick="savePomodoroSettings()"
                >
                  Save Settings
                </button>
              </div>

              <div class="action-footer">
                <label class="toggle-label">
                  <input
                    type="checkbox"
                    id="pomodoroInCycle"
                    onchange="togglePomodoroInCycle()"
                  />
                  Show in Display Cycle
                </label>
              </div>
            </div>
          </section>

          <!-- System Settings -->
          <section class="card settings-section">
            <div class="card-header">
              <h2>System Preferences</h2>
            </div>

            <div class="accordion" id="settingsAccordion">
              <!-- Display Section -->
              <div class="accordion-item expanded" data-section="display">
                <button
                  class="accordion-header"
                  onclick="toggleAccordion('display')"
                >
                  <span class="accordion-title">
                    <span class="icon">üñ•Ô∏è</span> Display
                  </span>
                  <span class="accordion-chevron">‚ñº</span>
                </button>
                <div class="accordion-content">
                  <div class="accordion-body">
                    <div class="setting-row">
                      <div class="label-group">
                        <span>Show Headers</span>
                      </div>
                      <button
                        class="toggle-switch"
                        id="headersToggle"
                        onclick="toggleHeaders()"
                      >
                        <span class="toggle-indicator"></span>
                      </button>
                    </div>

                    <div class="setting-row">
                      <div class="label-group">
                        <span>Rotate 180¬∞</span>
                        <small>For upside-down mounting</small>
                      </div>
                      <button
                        class="toggle-switch"
                        id="rotationToggle"
                        onclick="toggleRotation()"
                      >
                        <span class="toggle-indicator"></span>
                      </button>
                    </div>

                    <div class="setting-row">
                      <div class="label-group">
                        <span>üìê Display Scale</span>
                        <small id="displayScaleValue">Normal</small>
                      </div>
                      <div class="scale-buttons" id="displayScaleButtons">
                        <button
                          class="scale-btn"
                          data-scale="compact"
                          onclick="setDisplayScale('compact')"
                        >
                          Compact
                        </button>
                        <button
                          class="scale-btn active"
                          data-scale="normal"
                          onclick="setDisplayScale('normal')"
                        >
                          Normal
                        </button>
                        <button
                          class="scale-btn"
                          data-scale="large"
                          onclick="setDisplayScale('large')"
                        >
                          Large
                        </button>
                      </div>
                    </div>

                    <div class="setting-block bcd-settings-block">
                      <label>üî¢ BCD Clock</label>
                      <div class="bcd-toggles">
                        <div class="bcd-toggle-row">
                          <span>Format</span>
                          <div class="toggle-group">
                            <button
                              class="toggle-opt"
                              id="bcd12hr"
                              onclick="setBCDFormat(false)"
                            >
                              12hr
                            </button>
                            <button
                              class="toggle-opt active"
                              id="bcd24hr"
                              onclick="setBCDFormat(true)"
                            >
                              24hr
                            </button>
                          </div>
                        </div>
                        <div class="bcd-toggle-row">
                          <span>Seconds</span>
                          <button
                            class="toggle-switch active"
                            id="bcdSecondsToggle"
                            onclick="toggleBCDSeconds()"
                          >
                            <span class="toggle-indicator"></span>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="setting-block analog-settings-block">
                    <label>üßÆ Analog Clock</label>
                    <div class="analog-toggles">
                      <div class="analog-toggle-row">
                        <span>Second Hand</span>
                        <button
                          class="toggle-switch"
                          id="analogSecondsToggle"
                          onclick="toggleAnalogSeconds()"
                        >
                          <span class="toggle-indicator"></span>
                        </button>
                      </div>
                      <div class="analog-toggle-row">
                        <span>Show Numerals</span>
                        <button
                          class="toggle-switch"
                          id="analogRomanToggle"
                          onclick="toggleAnalogRoman()"
                        >
                          <span class="toggle-indicator"></span>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- LED Beacon Section -->
              <div class="accordion-item" data-section="led">
                <button
                  class="accordion-header"
                  onclick="toggleAccordion('led')"
                >
                  <span class="accordion-title">
                    <span class="icon">üí°</span> LED Beacon
                  </span>
                  <span class="accordion-chevron">‚ñº</span>
                </button>
                <div class="accordion-content">
                  <div class="accordion-body">
                    <div class="setting-row">
                      <div class="label-group">
                        <span>üõ∞Ô∏è LED Beacon</span>
                        <small id="ledBrightnessValue">50%</small>
                      </div>
                      <div class="beacon-controls">
                        <button
                          class="toggle-switch active"
                          id="beaconToggle"
                          onclick="toggleBeacon()"
                          title="Toggle beacon on/off"
                        >
                          <span class="toggle-indicator"></span>
                        </button>
                        <input
                          type="range"
                          class="mini-slider beacon-slider"
                          id="ledBrightnessSlider"
                          min="10"
                          max="100"
                          step="5"
                          value="50"
                          oninput="updateLedBrightness(this.value)"
                        />
                      </div>
                    </div>

                    <div class="setting-block led-effects-block">
                      <label>üé® LED Effect Mode</label>
                      <div class="effect-buttons" id="ledEffectButtons">
                        <button
                          type="button"
                          class="effect-btn active"
                          data-effect="auto"
                          onclick="setLedEffect('auto')"
                        >
                          Auto
                        </button>
                        <button
                          type="button"
                          class="effect-btn"
                          data-effect="static"
                          onclick="setLedEffect('static')"
                        >
                          Static
                        </button>
                        <button
                          type="button"
                          class="effect-btn"
                          data-effect="flash"
                          onclick="setLedEffect('flash')"
                        >
                          Flash
                        </button>
                        <button
                          type="button"
                          class="effect-btn"
                          data-effect="pulse"
                          onclick="setLedEffect('pulse')"
                        >
                          Pulse
                        </button>
                        <button
                          type="button"
                          class="effect-btn"
                          data-effect="rainbow"
                          onclick="setLedEffect('rainbow')"
                        >
                          Rainbow
                        </button>
                      </div>

                      <div
                        class="led-color-row"
                        id="ledColorRow"
                        style="display: none"
                      >
                        <label>Color</label>
                        <div class="color-presets">
                          <button
                            class="color-preset"
                            style="background: #ff0000"
                            onclick="setLedColor('#FF0000')"
                            title="Red"
                          ></button>
                          <button
                            class="color-preset"
                            style="background: #00ff00"
                            onclick="setLedColor('#00FF00')"
                            title="Green"
                          ></button>
                          <button
                            class="color-preset"
                            style="background: #0064ff"
                            onclick="setLedColor('#0064FF')"
                            title="Blue"
                          ></button>
                          <button
                            class="color-preset"
                            style="background: #ff6600"
                            onclick="setLedColor('#FF6600')"
                            title="Orange"
                          ></button>
                          <button
                            class="color-preset"
                            style="background: #ff00ff"
                            onclick="setLedColor('#FF00FF')"
                            title="Magenta"
                          ></button>
                          <button
                            class="color-preset"
                            style="background: #00ffff"
                            onclick="setLedColor('#00FFFF')"
                            title="Cyan"
                          ></button>
                        </div>
                        <input
                          type="color"
                          id="ledColorPicker"
                          value="#0064FF"
                          onchange="setLedColor(this.value)"
                          title="Custom color"
                        />
                      </div>

                      <div
                        class="led-rgb-sliders"
                        id="ledRgbSliders"
                        style="display: none"
                      >
                        <div class="rgb-slider-row">
                          <label style="color: #ff6666">R</label>
                          <input
                            type="range"
                            class="rgb-slider slider-red"
                            id="ledSliderR"
                            min="0"
                            max="255"
                            value="0"
                            oninput="updateRgbSlider()"
                          />
                          <input
                            type="number"
                            class="rgb-value"
                            id="ledValueR"
                            min="0"
                            max="255"
                            value="0"
                            oninput="updateRgbValue()"
                          />
                        </div>
                        <div class="rgb-slider-row">
                          <label style="color: #66ff66">G</label>
                          <input
                            type="range"
                            class="rgb-slider slider-green"
                            id="ledSliderG"
                            min="0"
                            max="255"
                            value="100"
                            oninput="updateRgbSlider()"
                          />
                          <input
                            type="number"
                            class="rgb-value"
                            id="ledValueG"
                            min="0"
                            max="255"
                            value="100"
                            oninput="updateRgbValue()"
                          />
                        </div>
                        <div class="rgb-slider-row">
                          <label style="color: #6699ff">B</label>
                          <input
                            type="range"
                            class="rgb-slider slider-blue"
                            id="ledSliderB"
                            min="0"
                            max="255"
                            value="255"
                            oninput="updateRgbSlider()"
                          />
                          <input
                            type="number"
                            class="rgb-value"
                            id="ledValueB"
                            min="0"
                            max="255"
                            value="255"
                            oninput="updateRgbValue()"
                          />
                        </div>
                        <div class="rgb-preview-row">
                          <div
                            class="rgb-preview-swatch"
                            id="rgbPreviewSwatch"
                            style="background: #0064ff"
                          ></div>
                          <input
                            type="text"
                            class="rgb-hex-input"
                            id="rgbHexInput"
                            value="#0064FF"
                            maxlength="7"
                            placeholder="#RRGGBB"
                            onchange="updateFromHexInput()"
                            onkeyup="if(event.key==='Enter') updateFromHexInput()"
                          />
                        </div>
                      </div>

                      <div
                        class="led-speed-row"
                        id="ledSpeedRow"
                        style="display: none"
                      >
                        <label
                          >Speed <span id="ledSpeedValue">500ms</span></label
                        >
                        <input
                          type="range"
                          class="mini-slider"
                          id="ledSpeedSlider"
                          min="100"
                          max="2000"
                          step="100"
                          value="500"
                          oninput="updateLedSpeed(this.value)"
                        />
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Spotify Section -->
              <div class="accordion-item" data-section="spotify">
                <button
                  class="accordion-header"
                  onclick="toggleAccordion('spotify')"
                >
                  <span class="accordion-title">
                    <span class="icon">üéµ</span> Spotify
                  </span>
                  <span class="accordion-chevron">‚ñº</span>
                </button>
                <div class="accordion-content">
                  <div class="accordion-body">
                    <div class="setting-row">
                      <div class="label-group">
                        <span>Status</span>
                        <small id="spotifyStatus">‚öôÔ∏è Not configured</small>
                      </div>
                      <div class="spotify-actions">
                        <button
                          class="btn btn-primary btn-sm"
                          id="spotifyConnectBtn"
                          onclick="connectSpotify()"
                          style="display: none"
                        >
                          Connect
                        </button>
                        <button
                          class="btn btn-danger btn-sm"
                          id="spotifyDisconnectBtn"
                          onclick="disconnectSpotify()"
                          style="display: none"
                        >
                          Disconnect
                        </button>
                      </div>
                    </div>

                    <div
                      class="env-notice"
                      id="spotifyEnvNotice"
                      style="display: none"
                    >
                      ‚úÖ Credentials configured via environment variables
                    </div>
                  </div>
                </div>
              </div>

              <!-- Environment Section -->
              <div class="accordion-item" data-section="environment">
                <button
                  class="accordion-header"
                  onclick="toggleAccordion('environment')"
                >
                  <span class="accordion-title">
                    <span class="icon">üåç</span> Environment
                  </span>
                  <span class="accordion-chevron">‚ñº</span>
                </button>
                <div class="accordion-content">
                  <div class="accordion-body">
                    <div class="setting-block">
                      <label>Timezone</label>
                      <select
                        id="timezoneSelect"
                        onchange="updateTimezone()"
                        class="modern-select full-width"
                      >
                        <optgroup label="Popular">
                          <option value="Asia/Kolkata" selected>
                            India (IST)
                          </option>
                          <option value="UTC">UTC</option>
                          <option value="America/New_York">New York</option>
                          <option value="Europe/London">London</option>
                        </optgroup>
                        <optgroup label="Asia">
                          <option value="Asia/Tokyo">Japan (JST)</option>
                          <option value="Asia/Shanghai">China (CST)</option>
                          <option value="Asia/Singapore">
                            Singapore (SGT)
                          </option>
                          <option value="Asia/Dubai">Dubai (GST)</option>
                          <option value="Asia/Hong_Kong">
                            Hong Kong (HKT)
                          </option>
                          <option value="Asia/Seoul">South Korea (KST)</option>
                        </optgroup>
                        <optgroup label="Europe">
                          <option value="Europe/Paris">Paris (CET)</option>
                          <option value="Europe/Berlin">Berlin (CET)</option>
                          <option value="Europe/Moscow">Moscow (MSK)</option>
                        </optgroup>
                        <optgroup label="Americas">
                          <option value="America/Los_Angeles">
                            Los Angeles (PST)
                          </option>
                          <option value="America/Chicago">Chicago (CST)</option>
                          <option value="America/Toronto">Toronto (EST)</option>
                          <option value="America/Sao_Paulo">
                            S√£o Paulo (BRT)
                          </option>
                        </optgroup>
                        <optgroup label="Pacific">
                          <option value="Australia/Sydney">
                            Sydney (AEST)
                          </option>
                          <option value="Pacific/Auckland">
                            Auckland (NZST)
                          </option>
                        </optgroup>
                      </select>
                    </div>

                    <div class="setting-block">
                      <label>Weather Location</label>
                      <select
                        id="citySelect"
                        onchange="changeCity()"
                        class="modern-select full-width"
                      >
                        <optgroup label="India">
                          <option value="22.57,88.36,Kolkata" selected>
                            Kolkata
                          </option>
                          <option value="28.61,77.21,New Delhi">
                            New Delhi
                          </option>
                          <option value="19.08,72.88,Mumbai">Mumbai</option>
                          <option value="13.08,80.27,Chennai">Chennai</option>
                          <option value="12.97,77.59,Bangalore">
                            Bangalore
                          </option>
                          <option value="17.39,78.49,Hyderabad">
                            Hyderabad
                          </option>
                          <option value="23.02,72.57,Ahmedabad">
                            Ahmedabad
                          </option>
                          <option value="26.85,80.95,Lucknow">Lucknow</option>
                          <option value="18.52,73.86,Pune">Pune</option>
                        </optgroup>
                        <optgroup label="World">
                          <option value="40.71,-74.01,New York">
                            New York
                          </option>
                          <option value="51.51,-0.13,London">London</option>
                          <option value="35.68,139.69,Tokyo">Tokyo</option>
                          <option value="48.86,2.35,Paris">Paris</option>
                          <option value="1.35,103.82,Singapore">
                            Singapore
                          </option>
                          <option value="25.20,55.27,Dubai">Dubai</option>
                          <option value="-33.87,151.21,Sydney">Sydney</option>
                          <option value="55.76,37.62,Moscow">Moscow</option>
                        </optgroup>
                      </select>
                    </div>

                    <div class="setting-info" id="weatherDisplay">
                      Loading weather...
                    </div>
                  </div>
                </div>
              </div>

              <!-- Advanced Section -->
              <div class="accordion-item" data-section="advanced">
                <button
                  class="accordion-header"
                  onclick="toggleAccordion('advanced')"
                >
                  <span class="accordion-title">
                    <span class="icon">‚öôÔ∏è</span> Advanced
                  </span>
                  <span class="accordion-chevron">‚ñº</span>
                </button>
                <div class="accordion-content">
                  <div class="accordion-body">
                    <div class="setting-row">
                      <div class="label-group">
                        <span>ESP Refresh</span>
                        <small id="espRefreshValue">3.0s</small>
                      </div>
                      <input
                        type="range"
                        class="mini-slider"
                        id="espRefreshSlider"
                        min="500"
                        max="10000"
                        step="500"
                        value="3000"
                        oninput="updateEspRefresh(this.value)"
                      />
                    </div>

                    <div class="setting-row danger-zone">
                      <div class="label-group">
                        <span>Reset Display</span>
                        <small>Clears current content</small>
                      </div>
                      <button
                        class="btn btn-danger btn-sm"
                        onclick="resetSystem()"
                      >
                        Reset
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/render.js"></script>
    <script src="js/api.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/autoplay.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/led.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/cycle.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/texthelper.js"></script>
    <script src="js/pomodoro.js"></script>
    <script src="js/qrcode.js"></script>
    <script src="js/accordion.js"></script>
    <script src="js/spotify.js"></script>
    <script src="js/app.js"></script>

    <script>
      // Simple tab implementation for the new layout
      function switchTab(tabId) {
        document
          .querySelectorAll(".tab-content")
          .forEach((el) => (el.style.display = "none"));
        document.getElementById("tab-" + tabId).style.display = "block";

        document
          .querySelectorAll(".tab-btn")
          .forEach((el) => el.classList.remove("active"));
        event.target.classList.add("active");
      }
    </script>
  </body>
</html>
