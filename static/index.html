<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ESP Desk_OS | Control Dashboard</title>
    <meta name="description" content="ESP32 OLED Display Control Dashboard" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <!-- Login Modal -->
    <div class="login-overlay" id="loginOverlay">
      <div class="login-card">
        <div class="login-header">
          <span class="login-icon">‚óá</span>
          <h2>ESP DESK_OS</h2>
        </div>
        <p class="login-subtitle">Enter password to access dashboard</p>
        <form id="loginForm" onsubmit="handleLogin(event)">
          <div class="login-input-group">
            <input
              type="password"
              id="loginPassword"
              placeholder="Password"
              autocomplete="current-password"
              required
            />
          </div>
          <div class="login-error" id="loginError"></div>
          <button type="submit" class="btn btn-primary login-btn" id="loginBtn">
            Access Dashboard
          </button>
        </form>
      </div>
    </div>

    <div class="container" id="mainContainer">
      <!-- Header -->
      <header class="header">
        <div class="logo">
          <span class="icon">‚óá</span>
          <h1>ESP DESK_OS</h1>
        </div>
        <div class="header-right">
          <div class="status-pill">
            <span class="dot"></span>
            <span id="systemStatus">ONLINE</span>
          </div>
          <button
            class="btn-logout"
            id="logoutBtn"
            onclick="handleLogout()"
            title="Logout"
            style="display: none"
          >
            ‚èª
          </button>
        </div>
      </header>

      <!-- Main Grid -->
      <main class="grid-layout">
        <!-- Visual Feed -->
        <section class="card preview-section">
          <div class="card-header">
            <h2>Visual Feed</h2>
            <div class="badge-group">
              <span class="badge" id="frameBadge">Frame 1/1</span>
              <span class="badge" id="mode-badge">AUTO</span>
            </div>
          </div>
          <div class="canvas-wrapper">
            <canvas id="preview" width="512" height="256"></canvas>
          </div>
          <div class="card-actions">
            <div class="action-row">
              <button class="btn btn-secondary" onclick="prevFrame()">
                ‚óÄ Prev
              </button>
              <button
                class="btn btn-primary"
                id="autoPlayBtn"
                onclick="toggleAutoPlay()"
              >
                ‚ñ∂ Auto-Play
              </button>
              <button class="btn btn-secondary" onclick="nextFrame()">
                Next ‚ñ∂
              </button>
            </div>
            <div class="slider-group">
              <label>Speed: <span id="speedValue">200ms</span></label>
              <input
                type="range"
                id="speedSlider"
                min="50"
                max="1000"
                value="200"
                oninput="updateSpeed(this.value)"
              />
            </div>
          </div>
        </section>

        <!-- Quick Text -->
        <section class="card control-section">
          <div class="card-header">
            <h2>Quick Text</h2>
          </div>
          <div class="input-group">
            <label for="customText">Message</label>
            <textarea
              id="customText"
              placeholder="Enter display text..."
              rows="2"
              maxlength="50"
            ></textarea>
            <div class="char-counter" id="customTextCounter">
              0/10 chars per line
            </div>
            <small class="input-hint">
              üí° Display shows max 10 characters per line. Extra characters wrap
              to next line.
            </small>
          </div>
          <div class="style-selector">
            <button
              class="style-btn active"
              data-style="normal"
              onclick="selectStyle('normal')"
            >
              Normal
            </button>
            <button
              class="style-btn"
              data-style="centered"
              onclick="selectStyle('centered')"
            >
              Centered
            </button>
            <button
              class="style-btn"
              data-style="framed"
              onclick="selectStyle('framed')"
            >
              Framed
            </button>
          </div>
          <div class="action-row">
            <button class="btn btn-primary" onclick="sendCustomText()">
              Display
            </button>
            <button class="btn btn-danger" onclick="resetSystem()">
              Reset
            </button>
          </div>
        </section>

        <!-- Marquee Text -->
        <section class="card control-section">
          <div class="card-header">
            <h2>Marquee / Scrolling Text</h2>
          </div>
          <div class="input-group">
            <label for="marqueeText">Scrolling Message</label>
            <input
              type="text"
              id="marqueeText"
              placeholder="This text will scroll across the display..."
              maxlength="100"
            />
            <div class="char-counter" id="marqueeTextCounter">
              0/10 chars per line
            </div>
            <small class="input-hint">
              üí° Scrolling helps display longer text, but each visible frame
              shows ~10 chars
            </small>
          </div>
          <div class="options-grid">
            <div class="option-group">
              <label>Direction</label>
              <div class="button-toggle">
                <button
                  class="toggle-btn active"
                  id="dirLeft"
                  onclick="setDirection('left')"
                >
                  ‚Üê Left
                </button>
                <button
                  class="toggle-btn"
                  id="dirRight"
                  onclick="setDirection('right')"
                >
                  Right ‚Üí
                </button>
              </div>
            </div>
            <div class="option-group">
              <label>Size</label>
              <div class="button-toggle">
                <button
                  class="toggle-btn"
                  data-size="1"
                  onclick="setMarqueeSize(1)"
                >
                  1x
                </button>
                <button
                  class="toggle-btn active"
                  data-size="2"
                  onclick="setMarqueeSize(2)"
                >
                  2x
                </button>
                <button
                  class="toggle-btn"
                  data-size="3"
                  onclick="setMarqueeSize(3)"
                >
                  3x
                </button>
              </div>
            </div>
            <div class="option-group">
              <label>Speed: <span id="marqueeSpeedVal">3</span>px/frame</label>
              <input
                type="range"
                id="marqueeSpeed"
                min="1"
                max="8"
                value="3"
                oninput="document.getElementById('marqueeSpeedVal').textContent=this.value"
              />
            </div>
          </div>
          <div class="action-row">
            <button class="btn btn-primary" onclick="sendMarquee()">
              Start Marquee
            </button>
          </div>
        </section>

        <!-- Media Upload -->
        <section class="card control-section">
          <div class="card-header">
            <h2>Media Upload</h2>
            <span class="badge" id="uploadStatus">Ready</span>
          </div>
          <div class="info-alert">
            <span class="info-icon">‚ÑπÔ∏è</span>
            <div class="info-text">
              <strong>GIF Playback:</strong> Animations may briefly pause every
              30 seconds while checking for updates. This is normal behavior.
            </div>
          </div>
          <div class="drop-zone" id="dropZone" tabindex="0">
            <div class="drop-zone-content">
              <div class="drop-zone-icon">üìÅ</div>
              <p class="drop-zone-text">
                <strong>Drop image here</strong> or click to browse
              </p>
              <p class="drop-zone-hint">
                Supports PNG, JPG, GIF ‚Ä¢ Paste with Ctrl+V
              </p>
            </div>
            <input type="file" id="imageUpload" accept="image/*" hidden />
          </div>
          <div class="upload-preview" id="uploadPreview" style="display: none">
            <img id="previewThumbnail" alt="Preview" />
            <div class="preview-info">
              <span id="previewFileName">filename.png</span>
              <button class="btn-clear" onclick="clearUploadPreview()">
                ‚úï
              </button>
            </div>
          </div>
          <div class="action-row">
            <button class="btn btn-primary" onclick="processAndUploadImage()">
              Upload
            </button>
            <button
              class="btn btn-secondary"
              id="saveToCycleBtn"
              onclick="saveImageToCycle()"
              style="display: none"
            >
              üíæ Save to Cycle
            </button>
          </div>
          <div class="gif-fps-control">
            <label>GIF Playback: <span id="gifFpsValue">Original</span></label>
            <div class="fps-slider-row">
              <input
                type="range"
                id="gifFpsSlider"
                min="0"
                max="30"
                value="0"
                oninput="updateGifFps(this.value)"
              />
              <button class="btn btn-small" onclick="resetGifFps()">
                Reset
              </button>
            </div>
            <small class="fps-hint"
              >0 = Use original timing, 5-30 = Override FPS</small
            >
          </div>
        </section>

        <section class="card config-section">
          <div class="card-header">
            <h2>Settings</h2>
          </div>
          <div class="settings-grid">
            <div class="setting-item">
              <span>Show Headers</span>
              <button
                class="toggle-switch"
                id="headersToggle"
                onclick="toggleHeaders()"
              >
                <span class="toggle-indicator"></span>
              </button>
            </div>
            <div class="setting-item esp-refresh-setting">
              <span>ESP Refresh Rate</span>
              <div class="slider-inline">
                <input
                  type="range"
                  id="espRefreshSlider"
                  min="500"
                  max="10000"
                  step="500"
                  value="3000"
                  oninput="updateEspRefresh(this.value)"
                />
                <span id="espRefreshValue">3.0s</span>
              </div>
            </div>
            <div class="setting-item city-setting">
              <span>Weather City</span>
              <select id="citySelect" onchange="changeCity()">
                <optgroup label="India">
                  <option value="22.57,88.36,Kolkata" selected>Kolkata</option>
                  <option value="28.61,77.21,New Delhi">New Delhi</option>
                  <option value="19.08,72.88,Mumbai">Mumbai</option>
                  <option value="13.08,80.27,Chennai">Chennai</option>
                  <option value="12.97,77.59,Bangalore">Bangalore</option>
                  <option value="17.39,78.49,Hyderabad">Hyderabad</option>
                  <option value="23.02,72.57,Ahmedabad">Ahmedabad</option>
                  <option value="26.85,80.95,Lucknow">Lucknow</option>
                  <option value="18.52,73.86,Pune">Pune</option>
                </optgroup>
                <optgroup label="World">
                  <option value="40.71,-74.01,New York">New York</option>
                  <option value="51.51,-0.13,London">London</option>
                  <option value="35.68,139.69,Tokyo">Tokyo</option>
                  <option value="48.86,2.35,Paris">Paris</option>
                  <option value="1.35,103.82,Singapore">Singapore</option>
                  <option value="25.20,55.27,Dubai">Dubai</option>
                  <option value="-33.87,151.21,Sydney">Sydney</option>
                  <option value="55.76,37.62,Moscow">Moscow</option>
                </optgroup>
              </select>
            </div>
            <div class="setting-item weather-display" id="weatherDisplay">
              <span class="weather-info">Loading weather...</span>
            </div>
            <div class="setting-item display-cycle-setting">
              <div class="display-cycle-header">
                <span>Display Cycle</span>
                <small>Drag to reorder ‚Ä¢ Add custom items</small>
              </div>
              <div class="display-cycle-list" id="displayCycleList">
                <!-- Items will be dynamically generated -->
              </div>
              <div class="cycle-add-controls">
                <select id="addItemType">
                  <option value="time">üïê Time Widget</option>
                  <option value="weather">üå§ Weather Widget</option>
                  <option value="uptime">‚è± Uptime Widget</option>
                  <option value="text">üí¨ Custom Text</option>
                  <option value="image">üñº Saved Image</option>
                </select>
                <button class="btn btn-small btn-add" onclick="addCycleItem()">
                  + Add
                </button>
              </div>
              <div
                class="text-item-config"
                id="textItemConfig"
                style="display: none"
              >
                <input
                  type="text"
                  id="newItemText"
                  placeholder="Enter text message..."
                  maxlength="30"
                />
                <div class="text-style-options">
                  <button
                    class="style-mini-btn active"
                    data-style="normal"
                    onclick="setNewItemStyle('normal')"
                  >
                    Normal
                  </button>
                  <button
                    class="style-mini-btn"
                    data-style="centered"
                    onclick="setNewItemStyle('centered')"
                  >
                    Center
                  </button>
                  <button
                    class="style-mini-btn"
                    data-style="framed"
                    onclick="setNewItemStyle('framed')"
                  >
                    Frame
                  </button>
                </div>
                <button
                  class="btn btn-primary btn-small"
                  onclick="confirmAddText()"
                >
                  Add Text
                </button>
              </div>
            </div>
          </div>
        </section>
      </main>
    </div>

    <!-- JavaScript Modules (load order matters) -->
    <script src="js/utils.js"></script>
    <script src="js/render.js"></script>
    <script src="js/api.js"></script>
    <script src="js/upload.js"></script>
    <script src="js/autoplay.js"></script>
    <script src="js/controls.js"></script>
    <script src="js/weather.js"></script>
    <script src="js/cycle.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/texthelper.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>
